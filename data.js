
/**
 * Zensho Bookkeeping Grade 3 Practice App
 * Data Module - Common Data & Helpers
 */

// --- Helpers for Randomization ---
const Randomizer = {
  round: (num, precision = 1000) => Math.round(num / precision) * precision,
  getAmount: (base, variation = 0.2, precision = 1000) => {
    const min = base * (1 - variation);
    const max = base * (1 + variation);
    const raw = Math.random() * (max - min) + min;
    return Randomizer.round(raw, precision);
  },
  fmt: (num) => num.toLocaleString(),
  updateSteps: (steps, mapObj) => { return steps; } 
};

// --- Collection Data (30 Items) ---
const COLLECTION_ITEMS = [
  // Common (15)
  { 
    id: 1, name: "現金", rarity: 1, icon: "💰", 
    desc: "ビジネスの血液。硬貨や紙幣はもちろん、「銀行に持って行けばすぐお金になる紙（他店振出小切手など）」も簿記上は現金扱い。\n金庫番の最大の敵はインフレではなく、数え間違いです。" 
  },
  { 
    id: 2, name: "小切手", rarity: 1, icon: "🎫", 
    desc: "大金を持ち歩くリスクを回避する、商人の知恵の結晶。\n受け取れば「現金」として喜び、振り出せば「当座預金」が減る悲しみ。\n書き損じると銀行への届出が面倒なので、振出時は手が震えます。" 
  },
  { 
    id: 3, name: "当座預金", rarity: 1, icon: "🏦", 
    desc: "利息はつかないが、小切手や手形の決済ができる「決済専用口座」。\n通帳がなく、照合表で管理するプロ仕様。\n残高不足で不渡りを出すと、企業の社会的信用が即死します。" 
  },
  { 
    id: 4, name: "商品", rarity: 1, icon: "📦", 
    desc: "売るために仕入れたモノ。売れれば「売上」というスターになり、\n売れ残れば「在庫」という金食い虫になる運命。\n期末の棚卸し作業は、全経理担当者の年末の憂鬱です。" 
  },
  { 
    id: 5, name: "仕入", rarity: 1, icon: "🚚", 
    desc: "「費用」グループの特攻隊長。\n安く仕入れることが商売の基本ですが、安かろう悪かろうでは返品の嵐。\n仕入先との良好な関係は、貸借対照表には載らない隠れた資産です。" 
  },
  { 
    id: 6, name: "売上", rarity: 1, icon: "🏷️", 
    desc: "企業の通知表における「得点」。\nこれが立たないと会社は潰れるし、給料も出ない。\n計上基準（いつ売上にするか）は、監査法人と揉める原因No.1です。" 
  },
  { 
    id: 7, name: "通信費", rarity: 1, icon: "📮", 
    desc: "切手、電話、ネット代。現代ビジネスの生命線。\n簿記3級では「切手を買ったら即費用（通信費）」が基本ルール。\n引き出しに大量の未使用切手が眠っていても、買った時に費用なのです。" 
  },
  { 
    id: 8, name: "消耗品費", rarity: 1, icon: "✏️", 
    desc: "ペン、ノート、コピー用紙。使えば消える、儚いモノたち。\n文房具マニアが発注を担当すると、謎に高機能なボールペンが増え、\nこの勘定科目が膨れ上がるという怪現象が発生します。" 
  },
  { 
    id: 9, name: "旅費交通費", rarity: 1, icon: "🚕", 
    desc: "営業マンの足代。電車、バス、タクシー、宿泊費。\nICカードへのチャージは、厳密には「貯蔵品」だが、\n面倒なので実務上はチャージした瞬間に費用処理しがちです。" 
  },
  { 
    id: 10, name: "借入金", rarity: 1, icon: "💸", 
    desc: "銀行への「後で返します」という重い約束。\n適度な借金は「レバレッジ」と呼ばれ事業加速の燃料になりますが、\n返済日は待ってくれません。資金繰り表とにらめっこする原因です。" 
  },
  { 
    id: 11, name: "貸付金", rarity: 1, icon: "🤝", 
    desc: "他人にお金を貸す権利。「利息」という果実を生みます。\nただし、「金の切れ目が縁の切れ目」。\n相手が飛んだら、それはただの「貸倒損失」という悲劇に変わります。" 
  },
  { 
    id: 12, name: "受取手形", rarity: 1, icon: "📜", 
    desc: "数ヶ月後に現金化できる約束の紙。\n売掛金よりも法的な強制力が強い最強の債権証書ですが、\n紙切れ一枚紛失しただけで大騒ぎになる、管理コストの高いシロモノ。" 
  },
  { 
    id: 13, name: "支払手形", rarity: 1, icon: "✍️", 
    desc: "支払いを数ヶ月待ってもらう魔法の紙。\n資金繰りが楽になる反面、期日に決済できないと「不渡り」となり、\n2回やらかすと銀行取引停止＝事実上の倒産というデスゲームの始まり。" 
  },
  { 
    id: 14, name: "売掛金", rarity: 1, icon: "📓", 
    desc: "いわゆる「ツケ」。日本の商習慣の根幹。\n「来月末に払うね」という口約束に近い信頼関係で成り立っています。\n回収して初めて「売上」が完了することを、営業マンは忘れがちです。" 
  },
  { 
    id: 15, name: "買掛金", rarity: 1, icon: "🧾", 
    desc: "仕入先への「ツケ払い」。\n支払いを待ってもらっている間、その資金を他に回せるため、\n実質的には「無利息で借金している」のと同じ効果があります。" 
  },
  
  // Rare (10)
  { 
    id: 16, name: "引出金", rarity: 2, icon: "👜", 
    desc: "個人商店主の特権（？）。店のレジから生活費を抜く行為。\n公私混同の極みですが、個人事業主なら避けて通れない道。\n決算整理で資本金と相殺され、無かったことにされます。" 
  },
  { 
    id: 17, name: "租税公課", rarity: 2, icon: "🏛️", 
    desc: "税金（租税）と、公的な会費や罰金（公課）。\n固定資産税や印紙税はこれ。稼げば稼ぐほど増える必要経費。\nただし、社長個人の所得税はここに入れてはいけません（引出金へ）。" 
  },
  { 
    id: 18, name: "商品券", rarity: 2, icon: "🎁", 
    desc: "デパートや信販会社が発行する金券。\nもらうと嬉しい資産ですが、店側としては換金の手間がかかる存在。\nお釣りが出るか出ないかで、レジ前で揉める原因にもなります。" 
  },
  { 
    id: 19, name: "前払金", rarity: 2, icon: "🔜", 
    desc: "商品を受け取る前に払う「手付金」。\n「金」とつくが、お金ではなく「商品を受け取る権利」なので資産。\n予約商品や高額な特注品を注文する際の、信頼の証です。" 
  },
  { 
    id: 20, name: "前受金", rarity: 2, icon: "🔙", 
    desc: "商品を渡す前に受け取った「手付金」。\nお金は増えるが、「後で商品を渡す義務」なので負債扱い。\n売上が確定するまでは、ぬか喜びしてはいけないお金です。" 
  },
  { 
    id: 21, name: "未払金", rarity: 2, icon: "🛒", 
    desc: "商品「以外」のモノを買って、後払いにした時の名前。\nパソコンや車を買ったツケはこれ。買掛金との使い分けは簿記の基本。\n「営業活動のツケ」か「それ以外のツケ」かの違いです。" 
  },
  { 
    id: 22, name: "備品", rarity: 2, icon: "💻", 
    desc: "1年以上使うPC、机、椅子など。\n買った瞬間は資産だが、時の流れと共に価値が減り（減価償却）、\n最後はゴミ（廃棄損）になる、諸行無常を体現する勘定科目。" 
  },
  { 
    id: 23, name: "車両運搬具", rarity: 2, icon: "🚛", 
    desc: "社用車やトラック。本体価格だけでなく、\n「お店の名前入れ代」や「納車費用」まで含めて資産計上します。\nガソリン代はここには入れず「車両費」や「旅費交通費」へ。" 
  },
  { 
    id: 24, name: "貸倒引当金", rarity: 2, icon: "🛡️", 
    desc: "「たぶん返ってこないだろうな...」という未来の損失を、\n今のうちに予想して計上しておくネガティブな勘定科目。\n資産のマイナスを表す「評価勘定」というレアな属性を持ちます。" 
  },
  { 
    id: 25, name: "減価償却費", rarity: 2, icon: "📉", 
    desc: "建物や車の「劣化分」を費用にする手続き。\nお金が出ていかないのに費用になるため、節税効果が絶大。\n「魔法の費用」とも呼ばれ、経営者にとってはありがたい存在。" 
  },

  // Super Rare (5)
  { 
    id: 26, name: "資本金", rarity: 3, icon: "👑", 
    desc: "ビジネスの元手。誰にも返す必要がない最強の資金。\n個人商店では「元入金」とも呼ばれます。\nこれがマイナスになると「債務超過」と呼ばれ、倒産の足音が聞こえます。" 
  },
  { 
    id: 27, name: "土地", rarity: 3, icon: "🏰", 
    desc: "唯一、時間が経っても価値が減らない（減価償却しない）固定資産。\nバブル期は「土地転がし」で主役でしたが、今は本業を支える土台。\n簿記上は、上に建物が建っていても別々の資産として扱います。" 
  },
  { 
    id: 28, name: "建物", rarity: 3, icon: "🏢", 
    desc: "店舗や倉庫。土地とは違い、古くなれば価値が下がる。\n内装工事や電気設備もまとめて「建物」にされることが多いです。\n修繕費と資本的支出（資産価値アップ）の区分けは、実務の難所。" 
  },
  { 
    id: 29, name: "損益", rarity: 3, icon: "⚖️", 
    desc: "決算の時だけ現れる、幻の集合場所。\n一年間の全ての「収益」と「費用」をここに集めて戦わせます。\n収益が勝てば純利益、費用が勝てば純損失。勝負のリングです。" 
  },
  { 
    id: 30, name: "純利益", rarity: 3, icon: "💎", 
    desc: "一年間の努力の結晶。税金を引く前の、正真正銘の儲け。\nこの数字を出すために、経理担当者は決算期に残業を重ねます。\n個人企業の場合、この利益はそのまま店主の「資本金」に合体します。" 
  }
];

// --- Genre Configuration ---
const GENRE_STRUCTURE = [
  {
    id: 'cash_savings',
    title: '💰 現金・預金',
    subs: [
      { id: 'cash_basic', title: '現金・小切手' },
      { id: 'checking', title: '当座預金' },
      { id: 'petty_cash', title: '小口現金' },
      { id: 'short_over', title: '現金過不足' }
    ]
  },
  {
    id: 'merchandise',
    title: '📦 商品売買',
    subs: [
      { id: 'trade_basic', title: '仕入・売上' },
      { id: 'returns_discounts', title: '返品・値引' }, // Renamed
      { id: 'advance', title: '前払金・前受金' },
      { id: 'shipping', title: '諸掛り' },
      { id: 'other_pay', title: 'クレジット・商品券' }
    ]
  },
  {
    id: 'notes',
    title: '💴 手形・貸借',
    subs: [
      { id: 'notes_trade', title: '約束手形(売買)' },
      { id: 'notes_transfer', title: '裏書・割引' }, // New
      { id: 'loan_notes', title: '貸付・借入' }
    ]
  },
  {
    id: 'assets_expenses',
    title: '🏢 固定資産・経費',
    subs: [
      { id: 'fixed_assets', title: '固定資産購入' },
      { id: 'expenses', title: '諸経費・税金' }
    ]
  },
  {
    id: 'closing',
    title: '📊 決算整理',
    subs: [
      { id: 'bad_debts', title: '貸倒引当金' },
      { id: 'depreciation', title: '減価償却' },
      { id: 'inventory', title: '売上原価算定' },
      { id: 'deferral_accrual', title: '見越・繰延' },
      { id: 'tax', title: '税金・その他' }
    ]
  }
];
