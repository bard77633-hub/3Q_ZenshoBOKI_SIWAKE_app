
/**
 * Zensho Bookkeeping Grade 3 Practice App
 * Data Module - Common Data & Helpers
 */

// --- Helpers for Randomization ---
const Randomizer = {
  round: (num, precision = 1000) => Math.round(num / precision) * precision,
  getAmount: (base, variation = 0.2, precision = 1000) => {
    const min = base * (1 - variation);
    const max = base * (1 + variation);
    const raw = Math.random() * (max - min) + min;
    return Randomizer.round(raw, precision);
  },
  fmt: (num) => num.toLocaleString(),
  updateSteps: (steps, mapObj) => { return steps; } 
};

// --- Collection Data (30 Items) ---
const COLLECTION_ITEMS = [
  // Common (15)
  { 
    id: 1, name: "現金", rarity: 1, icon: "💰", 
    desc: "ビジネスの血液とも言える最も流動性の高い資産。\n硬貨や紙幣だけでなく、他人振出小切手や送金小切手など、\n金融機関ですぐに換金できる証券も「現金」として扱います。" 
  },
  { 
    id: 2, name: "小切手", rarity: 1, icon: "🎫", 
    desc: "銀行に支払いを委託する証券。受け取れば「現金」だが、\n自分が振り出すと「当座預金」が減るという二面性を持つ。\n現金の持ち運びリスクを減らす、商取引の必需品です。" 
  },
  { 
    id: 3, name: "当座預金", rarity: 1, icon: "🏦", 
    desc: "小切手の支払いに充てられる決済専用の口座。\n利息は付かないが、手形や小切手の決済機能を持つため、\n企業活動においては財布代わりとなる重要な口座です。" 
  },
  { 
    id: 4, name: "商品", rarity: 1, icon: "📦", 
    desc: "販売目的で仕入れ、所有している物品のこと。\n期中に「仕入」として費用計上されたもののうち、\n売れ残った分は決算でこの資産勘定に振り替えられます。" 
  },
  { 
    id: 5, name: "仕入", rarity: 1, icon: "🚚", 
    desc: "商品を調達するためにかかった原価を表す費用勘定。\n「三分法」では、商品を買った瞬間に費用として計上し、\n決算時に在庫分を修正して売上原価を算定します。" 
  },
  { 
    id: 6, name: "売上", rarity: 1, icon: "🏷️", 
    desc: "営業活動の成果として得られる収益の柱。\n商品を引き渡し、対価を受け取る権利が発生した時点で計上します。\nこの金額から原価や経費を引いたものが利益となります。" 
  },
  { 
    id: 7, name: "通信費", rarity: 1, icon: "📮", 
    desc: "電話代、インターネット料金、郵便切手代などの費用。\n情報のやり取りや物品の送付に欠かせない経費です。\n切手は購入時にこの勘定で処理するのが一般的です。" 
  },
  { 
    id: 8, name: "消耗品費", rarity: 1, icon: "✏️", 
    desc: "ノート、ペン、コピー用紙など、短期間で使い切る物品の費用。\n実務では「使った分だけ費用」とするのが原則ですが、\n重要性が低い場合は購入時に全額費用処理することも認められます。" 
  },
  { 
    id: 9, name: "旅費交通費", rarity: 1, icon: "🚕", 
    desc: "業務のための移動にかかる電車、バス、タクシー代や宿泊費。\nICカードへのチャージ時ではなく、実際に利用した時に\n計上するのが原則ですが、実務上はチャージ時の処理も多いです。" 
  },
  { 
    id: 10, name: "借入金", rarity: 1, icon: "💸", 
    desc: "銀行などから資金を調達した際に生じる、後で返済する義務。\n事業拡大のテコとして活用されますが、利息の支払いが伴います。\n返済期間によって短期と長期に分類されることもあります。" 
  },
  { 
    id: 11, name: "貸付金", rarity: 1, icon: "🤝", 
    desc: "取引先や従業員にお金を貸した際に生じる、返済してもらう権利。\n利息を受け取ることができるため、資産運用の側面もあります。\n相手の信用力を見極めることが回収の鍵となります。" 
  },
  { 
    id: 12, name: "受取手形", rarity: 1, icon: "📜", 
    desc: "将来の期日に代金を受け取ることができる証券上の権利。\n売掛金よりも回収の確実性が高いとされますが、\n不渡り（決済できないこと）のリスクには注意が必要です。" 
  },
  { 
    id: 13, name: "支払手形", rarity: 1, icon: "✍️", 
    desc: "将来の期日に代金を支払うことを約束した証券上の義務。\n現金の支払いを先延ばしにできる資金繰りの手段ですが、\n期日に決済できないと銀行取引停止処分等の制裁を受けます。" 
  },
  { 
    id: 14, name: "売掛金", rarity: 1, icon: "📓", 
    desc: "商品を販売したが、まだ代金を受け取っていない状態（ツケ）。\n信用取引の基本であり、日本の商習慣では一般的です。\n早期に回収することがキャッシュフロー改善の鉄則です。" 
  },
  { 
    id: 15, name: "買掛金", rarity: 1, icon: "🧾", 
    desc: "商品を仕入れたが、まだ代金を支払っていない状態（ツケ）。\n支払う義務（債務）であり、資金繰りにおいては\n支払サイトを長く確保するほど手元資金に余裕が生まれます。" 
  },
  
  // Rare (10)
  { 
    id: 16, name: "引出金", rarity: 2, icon: "👜", 
    desc: "個人商店主が、店の資金を私用（生活費など）に使った額。\n資本金のマイナスとして扱われる勘定科目です。\n決算時に資本金と相殺して整理されることが多いです。" 
  },
  { 
    id: 17, name: "租税公課", rarity: 2, icon: "🏛️", 
    desc: "固定資産税や自動車税などの税金、および公的な負担金。\n収入印紙も「印紙税」という税金を払うものなのでこれに含まれます。\n所得税や住民税（店主個人にかかるもの）はこれに含まれません。" 
  },
  { 
    id: 18, name: "商品券", rarity: 2, icon: "🎁", 
    desc: "自治体やデパート等が発行する金券。\n受け取った場合は、後で換金できる資産として処理します。\n自社で発行した場合は「商品券」勘定ではなく負債として扱います。" 
  },
  { 
    id: 19, name: "前払金", rarity: 2, icon: "🔜", 
    desc: "商品を受け取る前に支払った手付金や内金のこと。\n「金」という字がつくが、後で商品を受け取る権利なので「資産」です。\n商品の引き渡しを受けた際に仕入勘定へ振り替えられます。" 
  },
  { 
    id: 20, name: "前受金", rarity: 2, icon: "🔙", 
    desc: "商品を渡す前に受け取った手付金や内金のこと。\n後で商品を引き渡す義務が生じるため「負債」となります。\n売上が確定した際に取り崩され、売上勘定に計上されます。" 
  },
  { 
    id: 21, name: "未払金", rarity: 2, icon: "🛒", 
    desc: "本来の営業取引（商品売買）以外の取引から生じた未払代金。\n備品や有価証券の購入などで後払いした際に使用します。\n買掛金との区別は「商品か、それ以外か」がポイントです。" 
  },
  { 
    id: 22, name: "備品", rarity: 2, icon: "💻", 
    desc: "パソコン、机、コピー機など、1年以上使用する資産。\n消耗品とは異なり、資産として計上後に減価償却を行います。\nオフィスの生産性を支える重要な固定資産です。" 
  },
  { 
    id: 23, name: "車両運搬具", rarity: 2, icon: "🚛", 
    desc: "営業車、トラック、フォークリフトなどの陸上運搬具。\n購入代金だけでなく、納車費用などの付随費用も取得原価に含めます。\n毎年価値が下がるため、減価償却の計算が欠かせません。" 
  },
  { 
    id: 24, name: "貸倒引当金", rarity: 2, icon: "🛡️", 
    desc: "将来、売掛金などが回収不能になるリスクに備えて見積もる金額。\n資産のマイナスを表す「評価勘定」という特殊な立ち位置です。\nリスクを事前に費用化する「保守主義」の考え方に基づきます。" 
  },
  { 
    id: 25, name: "減価償却費", rarity: 2, icon: "📉", 
    desc: "固定資産の使用や時の経過による価値の減少分を表す費用。\n現金の支出を伴わない費用（非資金費用）であることが特徴で、\n企業の自己金融効果（内部留保）をもたらす重要な手続きです。" 
  },

  // Super Rare (5)
  { 
    id: 26, name: "資本金", rarity: 3, icon: "👑", 
    desc: "事業の元手となる純資産（資産 － 負債）。\n個人企業では店主が最初に出資した元入金や、過去の利益の蓄積。\n「誰にも返済する必要がない資金」であり、経営の安定性を示します。" 
  },
  { 
    id: 27, name: "土地", rarity: 3, icon: "🏰", 
    desc: "店舗や事務所の敷地。\n建物とは異なり、時間が経過しても劣化しないため、\n減価償却を行わない（価値が減らない）特別な固定資産です。" 
  },
  { 
    id: 28, name: "建物", rarity: 3, icon: "🏢", 
    desc: "店舗、倉庫、事務所などの建物本体。\n電気設備や内装工事なども含めて計上されることが多いです。\n耐用年数が長く、長期にわたって減価償却が行われます。" 
  },
  { 
    id: 29, name: "損益", rarity: 3, icon: "⚖️", 
    desc: "決算時のみに登場する、収益と費用の集合場所。\nすべての収益と費用をここに集め、差額で純利益（または純損失）を計算します。\n一会計期間の成績表をまとめるための、架空のボックスのような勘定です。" 
  },
  { 
    id: 30, name: "純利益", rarity: 3, icon: "💎", 
    desc: "すべての収益からすべての費用を差し引いた、正味の儲け。\nビジネスの最終ゴールであり、企業の成長源泉。\n個人企業では、この利益がそのまま資本金に加算されます。" 
  }
];

// --- Genre Configuration ---
const GENRE_STRUCTURE = [
  {
    id: 'cash_savings',
    title: '💰 現金・預金',
    subs: [
      { id: 'cash_basic', title: '現金・小切手' },
      { id: 'checking', title: '当座預金' },
      { id: 'petty_cash', title: '小口現金' },
      { id: 'short_over', title: '現金過不足' }
    ]
  },
  {
    id: 'merchandise',
    title: '📦 商品売買',
    subs: [
      { id: 'trade_basic', title: '仕入・売上' },
      { id: 'returns_discounts', title: '返品・値引' }, // Renamed
      { id: 'advance', title: '前払金・前受金' },
      { id: 'shipping', title: '諸掛り' },
      { id: 'other_pay', title: 'クレジット・商品券' }
    ]
  },
  {
    id: 'notes',
    title: '💴 手形・貸借',
    subs: [
      { id: 'notes_trade', title: '約束手形(売買)' },
      { id: 'notes_transfer', title: '裏書・割引' }, // New
      { id: 'loan_notes', title: '貸付・借入' }
    ]
  },
  {
    id: 'assets_expenses',
    title: '🏢 固定資産・経費',
    subs: [
      { id: 'fixed_assets', title: '固定資産購入' },
      { id: 'expenses', title: '諸経費・税金' }
    ]
  },
  {
    id: 'closing',
    title: '📊 決算整理',
    subs: [
      { id: 'bad_debts', title: '貸倒引当金' },
      { id: 'depreciation', title: '減価償却' },
      { id: 'inventory', title: '売上原価算定' },
      { id: 'deferral_accrual', title: '見越・繰延' },
      { id: 'tax', title: '税金・その他' }
    ]
  }
];
